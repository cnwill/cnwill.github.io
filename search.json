[{"title":"Centos远程主机加固","url":"/tech/2020/07/15.html","content":"<p>目前互联网环境比较复杂，随着僵尸网络的不断扩大，ssh暴力破解相当严重，每个人的ssh密码都有可能存在被破解的可能，笔者刚刚安装好一台Linux远程主机，不一会就发现有人开始暴力破解密码，于是将自己的加固过程记录下来，已被以后查询。</p>\n<h2 id=\"0x01-添加非root用户并授权\"><a href=\"#0x01-添加非root用户并授权\" class=\"headerlink\" title=\"0x01 添加非root用户并授权\"></a>0x01 添加非root用户并授权</h2><ul>\n<li><p>添加用户</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_cenots ~]# adduser cnwill</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>给用户配置密码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~]# passwd cnwill</span><br><span class=\"line\">New password: </span><br><span class=\"line\">Retype new password: </span><br><span class=\"line\">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure></li>\n<li><p>对创建的新用户进行sudo操作的授权(/etc/sudoers )</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~]# whereis sudoers</span><br><span class=\"line\">sudoers: &#x2F;etc&#x2F;sudoers &#x2F;etc&#x2F;sudoers.d &#x2F;usr&#x2F;share&#x2F;man&#x2F;man5&#x2F;sudoers.5.gz</span><br></pre></td></tr></table></figure></li>\n<li><p>查看文件权限</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~]# ls -l &#x2F;etc&#x2F;sudoers</span><br><span class=\"line\">-r--r----- 1 root root 3927 Jul 15 09:04 &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure></li>\n<li><p>加入可写的权限</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~]# chmod -v u+w &#x2F;etc&#x2F;sudoers</span><br><span class=\"line\">mode of ‘&#x2F;etc&#x2F;sudoers’ changed from 0440 (r--r-----) to 0640 (rw-r-----)</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>将cnwill用户添加至sudoers文件中<br>使用vi编辑/etc/sudoers 文件，找到其中<code>root ALL=(ALL) ALL</code>这一行，之后在这行下面加入<br><code>cnwill ALL=(ALL) ALL</code>即可，<code>:wq</code>推出编辑</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~]# vi &#x2F;etc&#x2F;sudoers</span><br><span class=\"line\">## Allow root to run any commands anywher </span><br><span class=\"line\">root ALL&#x3D;(ALL) ALL </span><br><span class=\"line\">cnwill ALL&#x3D;(ALL) ALL</span><br></pre></td></tr></table></figure></li>\n<li><p>将sudoers文件的写权限收回</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~]# chmod -v u-w &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用cnwill进行登陆，并测测试sudo 权限:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~]#  su cnwill</span><br><span class=\"line\">[cnwill@VM_centos ~]$ sudo ifconfig</span><br><span class=\"line\">[sudo] password for cnwill: </span><br><span class=\"line\">eth0: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class=\"line\">        inet 172.24.35.55  netmask 255.255.240.0  broadcast 172.24.47.255</span><br><span class=\"line\">        ether 00:16:3e:00:c8:36  txqueuelen 1000  (Ethernet)</span><br><span class=\"line\">        RX packets 23509  bytes 25781988 (24.5 MiB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 6821  bytes 1134380 (1.0 MiB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class=\"line\"></span><br><span class=\"line\">lo: flags&#x3D;73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class=\"line\">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class=\"line\">        loop  txqueuelen 1  (Local Loopback)</span><br><span class=\"line\">        RX packets 0  bytes 0 (0.0 B)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 0  bytes 0 (0.0 B)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"0x02-修改ssh端口\"><a href=\"#0x02-修改ssh端口\" class=\"headerlink\" title=\"0x02 修改ssh端口\"></a>0x02 修改ssh端口</h2><p>默认在root用户下ssh服务已经安装完成，未安装的可以使用<code>yum install openssh-server</code>安装。</p>\n<ul>\n<li><p>进入ssh配置文件的目录（一般情况再<code>/etc/ssh</code>)，并编辑配置文件(sshd_config),使用vi编辑配置文件，找到如下位置，添加10011和 22（默认）；</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~] vi &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class=\"line\">#Port 22</span><br><span class=\"line\">#ListenAddress 0.0.0.0</span><br><span class=\"line\">#ListenAddress ::</span><br><span class=\"line\">port 10011</span><br><span class=\"line\">Port 22</span><br></pre></td></tr></table></figure></li>\n<li><p>向防火墙（本地主机）或者安全组（云主机）添加端口规则<br> ** 本地主机，或者是非阿里云这样的运营商的主机，向防火墙添加端口</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"> [root@VM_centos ~] # firewall-cmd --zone&#x3D;public --add-port&#x3D;10011&#x2F;tcp --permanent</span><br><span class=\"line\">[root@VM_centos ~] # firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n<p>** 如果你使用的是云主机，需要在云安全策略中添加1011号端口入栈任意地址。</p>\n</li>\n<li><p>向SELinux中添加修改的SSH端口<br>  <strong>安装semanage</strong></p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~] #  yum provides semanage</span><br></pre></td></tr></table></figure>\n<p>  <strong>查询ssh端口</strong></p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~] #  semanage port -l | grep ssh</span><br><span class=\"line\">ssh_port_t                     tcp      22</span><br></pre></td></tr></table></figure>\n<p>  <strong>向 SELinux 中添加 ssh 端口</strong></p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~] #  semanage port -a -t ssh_port_t -p tcp 10011</span><br></pre></td></tr></table></figure>\n<p>  <strong>查询ssh端口</strong></p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~] #  semanage port -l | grep ssh</span><br><span class=\"line\">ssh_port_t                     tcp      10011, 22</span><br></pre></td></tr></table></figure>\n<p>  <strong>重启ssh服务</strong></p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~] #  systemctl restart sshd.service</span><br></pre></td></tr></table></figure>\n<h2 id=\"0x03-加固ssh\"><a href=\"#0x03-加固ssh\" class=\"headerlink\" title=\"0x03 加固ssh\"></a>0x03 加固ssh</h2></li>\n<li><p>使用xshell生成rsa密钥对<br>打开xshell ，选择‘工具-》新建用户密码生成向导-》下一步-》下一步-》设置一个密钥用于加密私钥-》下一步-》文件另存为-》选择路径-》确定’。</p>\n</li>\n<li><p><em>tips：这里保存的是公钥，私钥默认已经加入到你的xshell里面了。*</em></p>\n</li>\n<li><p>配置ssh使用证书登录<br>将刚才生成的公钥文件上传到服务器/home/cnwill(这是我之前新建的用户)目录下，（我使用的方式是xftp，如果你安装的是x系列全家桶，可以使用同样的方式,），并新建<code>.ssh</code>文件夹,之后将上传的公钥文件rsa2048.pub移动到.ssh文件夹下，并重命名为authorized_keys.pub。之后配置sshd_config 文件。</p>\n</li>\n<li><p><em>tips：这里面有个”.”*</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~] #mv rsa2048.pub .ssh&#x2F;authorized_keys.pub</span><br><span class=\"line\">[root@VM_centos ~] #vi  &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class=\"line\">#允许密钥认证</span><br><span class=\"line\">RSAAuthentication yes</span><br><span class=\"line\">PubkeyAuthentication yes</span><br><span class=\"line\">StrictModes no</span><br><span class=\"line\">#公钥保存文件</span><br><span class=\"line\">AuthorizedKeysFile .ssh&#x2F;authorized_keys</span><br></pre></td></tr></table></figure></li>\n<li><p>禁用密码登录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">PasswordAuthentication no</span><br></pre></td></tr></table></figure></li>\n<li><p>禁止root用户远程登录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">PermitRootLogin no</span><br></pre></td></tr></table></figure>\n<p>完成之后<code>:wq</code>保存推出并重启ssh服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_centos ~] #  systemctl restart sshd.service</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n\n<div id=\"gitalk-container\"></div>\n<script src=\"https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js\"></script><link rel=\"stylesheet\" href=\"https://unpkg.com/gitalk/dist/gitalk.css\"><script src=\"https://unpkg.com/gitalk/dist/gitalk.min.js\"></script>\n\n\t\t<script>\n\t\tvar gitalkConfig = {\"owner\":\"cnwill\",\"repo\":\"cnwill.github.io\",\"client_id\":\"8483ad55de95cd24abdb\",\"client_secret\":\"fcadcecde7f60558fa498a46287c39d78be13557\",\"admin\":\"cnwill\",\"distractionFreeMode\":false};\n\t    gitalkConfig.id = md5(location.pathname);\n\t\tvar gitalk = new Gitalk(gitalkConfig);\n\t    gitalk.render(\"gitalk-container\");\n\t    </script>","categories":["tech"],"tags":["Centos 主机加固 ssh 端口 rsa证书登录 xshell"]},{"title":"techcento7.5 、 k8s、 rancher2.4 安装记录","url":"/tech/2020/07/09.html","content":"<h2 id=\"1-基础环境安装\"><a href=\"#1-基础环境安装\" class=\"headerlink\" title=\"1.基础环境安装\"></a>1.基础环境安装</h2><h3 id=\"1-1-修改操作系统源、docker-源\"><a href=\"#1-1-修改操作系统源、docker-源\" class=\"headerlink\" title=\"1.1 修改操作系统源、docker 源\"></a>1.1 修改操作系统源、docker 源</h3><h4 id=\"将-centos7-5-的系统源修改为国内主流站点的系统源\"><a href=\"#将-centos7-5-的系统源修改为国内主流站点的系统源\" class=\"headerlink\" title=\"将 centos7.5 的系统源修改为国内主流站点的系统源\"></a>将 centos7.5 的系统源修改为国内主流站点的系统源</h4><p>国内主流系统源</p>\n<ul>\n<li>中科大 linux 各类源 <a href=\"http://mirrors.ustc.edu.cn/\" target=\"_blank\" rel=\"noopener\">http://mirrors.ustc.edu.cn/</a></li>\n<li>阿里 linux 各类源 <a href=\"https://developer.aliyun.com/mirror\" target=\"_blank\" rel=\"noopener\">https://developer.aliyun.com/mirror</a></li>\n<li>163 linux 各类源 <a href=\"http://tel.mirrors.163.com/\" target=\"_blank\" rel=\"noopener\">http://tel.mirrors.163.com/</a><br>配置方法打开相应的网站有教程，按照教程配置就好。我的配置的是中科大的源<br>配置命令如下，<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@jiuwo-master ~]# sudo sed -e 's|^mirrorlist=|#mirrorlist=|g' \\</span><br><span class=\"line\">         -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.ustc.edu.cn/centos|g' \\         -i.bak \\</span><br><span class=\"line\">         /etc/yum.repos.d/CentOS-Base.repo</span><br></pre></td></tr></table></figure>\n配置完成后如下<br>cat /etc/yum.repos.d/Centos_base.pro<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> CentOS-Base.repo</span></span><br><span class=\"line\"><span class=\"meta\">#</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> The mirror system uses the connecting IP address of the client and the</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> update status of each mirror to pick mirrors that are updated to and</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> geographically close to the client.  You should use this <span class=\"keyword\">for</span> CentOS updates</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> unless you are manually picking other mirrors.</span></span><br><span class=\"line\"><span class=\"meta\">#</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> If the mirrorlist= does not work <span class=\"keyword\">for</span> you, as a fall back you can try the</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> remarked out baseurl= line instead.</span></span><br><span class=\"line\"><span class=\"meta\">#</span></span><br><span class=\"line\"><span class=\"meta\">#</span></span><br><span class=\"line\">[base]</span><br><span class=\"line\">name=CentOS-$releasever - Base</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">mirrorlist=http://mirrorlist.centos.org/?release=<span class=\"variable\">$releasever</span>&amp;arch=<span class=\"variable\">$basearch</span>&amp;repo=os&amp;infra=<span class=\"variable\">$infra</span></span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/$releasever/os/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">released updates</span></span><br><span class=\"line\">[updates]</span><br><span class=\"line\">name=CentOS-$releasever - Updates</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">mirrorlist=http://mirrorlist.centos.org/?release=<span class=\"variable\">$releasever</span>&amp;arch=<span class=\"variable\">$basearch</span>&amp;repo=updates&amp;infra=<span class=\"variable\">$infra</span></span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/$releasever/updates/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">additional packages that may be useful</span></span><br><span class=\"line\">[extras]</span><br><span class=\"line\">name=CentOS-$releasever - Extras</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">mirrorlist=http://mirrorlist.centos.org/?release=<span class=\"variable\">$releasever</span>&amp;arch=<span class=\"variable\">$basearch</span>&amp;repo=extras&amp;infra=<span class=\"variable\">$infra</span></span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/$releasever/extras/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">additional packages that extend functionality of existing packages</span></span><br><span class=\"line\">[centosplus]</span><br><span class=\"line\">name=CentOS-$releasever - Plus</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">mirrorlist=http://mirrorlist.centos.org/?release=<span class=\"variable\">$releasever</span>&amp;arch=<span class=\"variable\">$basearch</span>&amp;repo=centosplus&amp;infra=<span class=\"variable\">$infra</span></span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/$releasever/centosplus/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">enabled=0</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>\n配置完成后更新源缓存<br><code>[root@jiuwo-master ~]# yum makecache</code><h4 id=\"设置-docker-国内源\"><a href=\"#设置-docker-国内源\" class=\"headerlink\" title=\"设置 docker 国内源\"></a>设置 docker 国内源</h4>由于 dockerhub 在国外，收到 GFW 和网速的影响，在安装过程中容易出现各种问题，影响心情，所以修改 docker 源为国内的，前文提到的三个网站均提供国内的 docker 源。我使用的是阿里云的源，配置如下。<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@jiuwo-master ~]# yum install wget(如果已安装wget，此步可以忽略)</span><br><span class=\"line\">[root@jiuwo-master ~]# wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-安装-docker\"><a href=\"#1-2-安装-docker\" class=\"headerlink\" title=\"1.2 安装 docker\"></a>1.2 安装 docker</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@jiuwo-master ~]yum install docker-ce docker-ce-cli</span><br><span class=\"line\">…………此处省略一万字需要安装依赖的请输入YES</span><br><span class=\"line\">[root@jiuwo-master ~]# systemctl start docker</span><br><span class=\"line\">[root@jiuwo-master ~]# systemctl enable docker</span><br><span class=\"line\">[root@jiuwo-master ~]# docker -v</span><br><span class=\"line\">Docker version 19.03.8, build afacb8b</span><br></pre></td></tr></table></figure>\n如果遇到 <code>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</code>的问题可尝试以下方式解决<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ systemctl daemon-reload</span><br><span class=\"line\">$ sudo service docker restart</span><br><span class=\"line\">$ sudo service docker status (should see active (running))</span><br></pre></td></tr></table></figure>\n<h1 id=\"2、安装-k8s\"><a href=\"#2、安装-k8s\" class=\"headerlink\" title=\"2、安装 k8s\"></a>2、安装 k8s</h1><h2 id=\"内网加固\"><a href=\"#内网加固\" class=\"headerlink\" title=\"内网加固\"></a>内网加固</h2></li>\n</ul>\n<p><strong>对于etcd节点，运行以下命令：</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@jiuwo-master ~]# firewall-cmd --list-rich-rule</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;2376&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;2379&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;2380&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;8472&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;9099&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;10250&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;6643&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;10254&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;2380&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;8472&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;9099&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;10250&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;1180&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;11443&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;30000-32767&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --remove-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;139.130.99.162&#x2F;28&quot; port port&#x3D;&quot;30000-32767&quot; protocol&#x3D;&quot;udp&quot; accept&quot;</span><br></pre></td></tr></table></figure>\n<p><strong>对于control plane节点，运行以下命令：</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@jiuwo-master ~]# firewall-cmd --list-rich-rule</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;1180&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;11443&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;2376&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;6443&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;8472&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;9099&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;10250&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;10254&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;30000-32767&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;30000-32767&quot; protocol&#x3D;&quot;udp&quot; accept&quot;</span><br></pre></td></tr></table></figure>\n<p><strong>对于worker nodes节点，运行以下命令：</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">firewall-cmd --list-rich-rule</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;80&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;443&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;1180&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;11443&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;2376&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;6443&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;8472&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;9099&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;10250&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;10254&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;30000-32767&quot; protocol&#x3D;&quot;tcp&quot; accept&quot;</span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.99.162&#x2F;28&quot; port port&#x3D;&quot;30000-32767&quot; protocol&#x3D;&quot;udp&quot; accept&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n\n<p>firewall-cmd –permanent –add-rich-rule=”rule family=”ipv4” source address=”192.168.99.162” accept”</p>\n<p>参考文献</p>\n<ul>\n<li><a href=\"https://www.cnblogs.com/forturn/p/9371841.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/forturn/p/9371841.html</a></li>\n</ul>\n\n<div id=\"gitalk-container\"></div>\n<script src=\"https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js\"></script><link rel=\"stylesheet\" href=\"https://unpkg.com/gitalk/dist/gitalk.css\"><script src=\"https://unpkg.com/gitalk/dist/gitalk.min.js\"></script>\n\n\t\t<script>\n\t\tvar gitalkConfig = {\"owner\":\"cnwill\",\"repo\":\"cnwill.github.io\",\"client_id\":\"8483ad55de95cd24abdb\",\"client_secret\":\"fcadcecde7f60558fa498a46287c39d78be13557\",\"admin\":\"cnwill\",\"distractionFreeMode\":false};\n\t    gitalkConfig.id = md5(location.pathname);\n\t\tvar gitalk = new Gitalk(gitalkConfig);\n\t    gitalk.render(\"gitalk-container\");\n\t    </script>","categories":["tech"],"tags":["k8s","rancher2.4","centos7.5","配置","主机加固","国内源"]},{"title":"纪念我的兄弟","url":"/feel/2020/07/09.html","content":"<p>6月27日 突闻当年的同学因工作原因倒在了那神圣的雪山高原，一时有感而发，赋诗一首，以悼念的兄弟。</p>\n<pre><code>  悼念兄弟\n\n满腔热血入军营，\n铮铮铁骨驻高原。\n一生军旅终无悔，\n而立之花凋雪山。\n\n            cnwill\n            2020.6.28</code></pre><p><a href=\"https://imgchr.com/i/UuM6Ig\" target=\"_blank\" rel=\"noopener\"><img src=\"https://s1.ax1x.com/2020/07/10/UuM6Ig.md.png\" alt=\"UuM6Ig.md.png\"></a></p>\n<p>另附其他兄弟写的一些悼文：</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5MzQ3NTAzNg==&mid=2652042267&idx=1&sn=2fea26b9f9b273fab834a3c4212c3d70&chksm=bd7024a88a07adbef64aca0bbbe3b95a2bc9cbf3870afe7d58a98345ed538fba78afa813ec33&mpshare=1&scene=1&srcid=07042OwSlXBltjthB1xdhXkr&sharer_sharetime=1593871907683&sharer_shareid=fc59c4bf4bef72df203a0b73eefe052e&key=8f5da831c1477af592a9ada697359b0e1b0ce976e6f52c03988b5b7cf243647ec989c435793c4bdc85f7f897497bb9b90fc1514d995adf32b8df7e59cbc417cf0a40d9837332abbaef70509a4a2b4918&ascene=1&uin=Njk3MjgzNQ%3D%3D&devicetype=Windows+10+x64&version=62090529&lang=zh_CN&exportkey=AS7FRfa4%2FXpvbFYDEaUFJ%2F0%3D&pass_ticket=l5%2BOeirQ2Ea5NqKo0dYostmkMESlvOniTLjtj5IwEv4%3D\" target=\"_blank\" rel=\"noopener\">我的战友，牺牲在西藏 </a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzI3ODU0MjMyMw==&mid=2247508251&idx=5&sn=020a82f236a4b8566ebf6f6cc56d3b3e&chksm=eb578387dc200a9177b4c916f691247e45e25e1b5fc0cac15c06475d5fd15d61de4d86fc704b&mpshare=1&scene=1&srcid=&sharer_sharetime=1593658662767&sharer_shareid=5ebdb2be2dad89a3da6b86d967742a28&key=a1183f4560d3e24e354abe8eca1f5c6159e74cb7f07890d4b049508e29a63a1e254311cdef57ebc9714d50e5ad7e81fcee17798230f4336305310d7904ff3d5c281faa266fe45afa2e9dd5568fdc6024&ascene=1&uin=Njk3MjgzNQ%3D%3D&devicetype=Windows+10+x64&version=62090529&lang=zh_CN&exportkey=AWiUFjfQct2OUkrl2zFvhk8%3D&pass_ticket=l5%2BOeirQ2Ea5NqKo0dYostmkMESlvOniTLjtj5IwEv4%3D\" target=\"_blank\" rel=\"noopener\">那个又倒在天边的军人，是我并肩苦过的战友！</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzIwNjQzODAyMQ==&mid=2247600903&idx=1&sn=157e68836755d20153ed9bd1bf3382d2&chksm=9722a0eda05529fbbe27ac29cc06d53ac132fc46741cba3d75d805241fccf711694ace558495&mpshare=1&scene=1&srcid=&sharer_sharetime=1593439843241&sharer_shareid=fc59c4bf4bef72df203a0b73eefe052e&key=8f5da831c1477af52914bdc09749515fe65f6144ec143d185dcddc5347a9a24b88d45d52dd663d5a62eba6dcd78a01e83e9a14a2fd0d5bdff604805cd23ab2e7601aaa08bff1739fb445e5e830f412a9&ascene=1&uin=Njk3MjgzNQ%3D%3D&devicetype=Windows+10+x64&version=62090529&lang=zh_CN&exportkey=AYqxCp%2B9vVxyn%2FyVl9ijKBI%3D&pass_ticket=l5%2BOeirQ2Ea5NqKo0dYostmkMESlvOniTLjtj5IwEv4%3D\" target=\"_blank\" rel=\"noopener\">又有一位战友，倒在了离天最近的地方</a></p>\n\n<div id=\"gitalk-container\"></div>\n<script src=\"https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js\"></script><link rel=\"stylesheet\" href=\"https://unpkg.com/gitalk/dist/gitalk.css\"><script src=\"https://unpkg.com/gitalk/dist/gitalk.min.js\"></script>\n\n\t\t<script>\n\t\tvar gitalkConfig = {\"owner\":\"cnwill\",\"repo\":\"cnwill.github.io\",\"client_id\":\"8483ad55de95cd24abdb\",\"client_secret\":\"fcadcecde7f60558fa498a46287c39d78be13557\",\"admin\":\"cnwill\",\"distractionFreeMode\":false};\n\t    gitalkConfig.id = md5(location.pathname);\n\t\tvar gitalk = new Gitalk(gitalkConfig);\n\t    gitalk.render(\"gitalk-container\");\n\t    </script>","categories":["feel"],"tags":["悼念","军营","过去","雪山高原"]},{"title":"about me","url":"/about/index.html","content":"<p>一个简简单单纯粹的人，执迷于技术，也有点小情调。经历过大起大落，内心逐渐归于平淡，热爱厨艺，喜欢吃，哈哈哈。<br>email：<a href=\"mailto:cnwill.sec@gmail.com\">cnwill.sec@gmail.com</a><br>github:github.com/cnwill</p>\n\n<div id=\"gitalk-container\"></div>\n<script src=\"https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js\"></script><link rel=\"stylesheet\" href=\"https://unpkg.com/gitalk/dist/gitalk.css\"><script src=\"https://unpkg.com/gitalk/dist/gitalk.min.js\"></script>\n\n\t\t<script>\n\t\tvar gitalkConfig = {\"owner\":\"cnwill\",\"repo\":\"cnwill.github.io\",\"client_id\":\"8483ad55de95cd24abdb\",\"client_secret\":\"fcadcecde7f60558fa498a46287c39d78be13557\",\"admin\":\"cnwill\",\"distractionFreeMode\":false};\n\t    gitalkConfig.id = md5(location.pathname);\n\t\tvar gitalk = new Gitalk(gitalkConfig);\n\t    gitalk.render(\"gitalk-container\");\n\t    </script>"},{"title":"Tagcloud","url":"/tags/index.html","content":"\n<div id=\"gitalk-container\"></div>\n<script src=\"https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js\"></script><link rel=\"stylesheet\" href=\"https://unpkg.com/gitalk/dist/gitalk.css\"><script src=\"https://unpkg.com/gitalk/dist/gitalk.min.js\"></script>\n\n\t\t<script>\n\t\tvar gitalkConfig = {\"owner\":\"cnwill\",\"repo\":\"cnwill.github.io\",\"client_id\":\"8483ad55de95cd24abdb\",\"client_secret\":\"fcadcecde7f60558fa498a46287c39d78be13557\",\"admin\":\"cnwill\",\"distractionFreeMode\":false};\n\t    gitalkConfig.id = md5(location.pathname);\n\t\tvar gitalk = new Gitalk(gitalkConfig);\n\t    gitalk.render(\"gitalk-container\");\n\t    </script>"}]